"use strict";!function(e){var i={init:function(t){i.config={cookieDomain:".nadex.com",attributionCookieNames:["qpid","salesAttribution","referralID"],salesAttribution:[{key:"s_kwcid",type:"adGroupId",delimiter:"!",section:3},{key:"crid",type:"creativeId"}],referAFriends:[{name:"referralID",key:"referralID",cookieName:"referralID",duration:30}],affiliates:[{name:"cellexpert",key:"cx_",type:"affiliate",affliateMappings:{affiliateId:"cx_aid",anSessionId:"cx_us",productGroup:"cx_pg",creativeId:"cx_cid"}}]},e.extend(i.config,t),i.trackReferrers()},trackReferrers:function(){i.processReferrers()},processReferrers:function(){i.processQpid(),i.processSalesAttribution(),i.processReferAFriends(),i.processAffliates()},clearAttribution:function(){function e(e){-1===r.indexOf(e)&&r.push(e)}var r=[];if(0===arguments.length)r=i.config.attributionCookieNames;else for(var n=arguments.length-1;n>=0;n--)e(arguments[n]);for(var n=r.length-1;n>=0;n--)t.eatCookie(r[n])},processQpid:function(){var e=i.getAttributionValue("qpid"),r=i.getAttributionValue("qppid")||"",n=!1,o=!!t.getCookie("salesAttribution")&&t.getCookie("salesAttribution").indexOf("affiliateId")>-1,a="3"===t.getQueryStringVariable("chid")&&o;e&&!a&&(n=e,""!==r&&(n+=","+r),i.saveAttribution("qpid",n,30,!0))},processSalesAttribution:function(){for(var e,t,r={},n=0;n<i.config.salesAttribution.length;n++)e=i.config.salesAttribution[n],(t=i.getAttributionValue(e.key,e.delimiter,e.section))&&(r[e.type]=t,i.clearAttribution("referralID"),i.saveSalesAttributionJson(r))},processReferAFriends:function(){for(var e,t,r=0;r<i.config.referAFriends.length;r++)t=i.config.referAFriends[r],(e=i.getAttributionValue(t.key,t.delimiter,t.section))&&i.saveAttribution(t.cookieName,e,t.duration,!0)},processAffliates:function(){for(var e,t=0;t<i.config.affiliates.length;t++)e=i.config.affiliates[t],i.processAffliate(e.key,e.affliateMappings)},getAttributionValue:function(e,i,r){var n=t.getQueryStringVariable(e)||!1;return i&&!r&&(n=!1,console.log("tracking: invalid delimiter and section combination for key: "+e," delimiter: "+i," section: "+r)),n&&i&&r&&(n=n.split(i)[r]||!1,console.log("tracking: invalid section for delimiter for key: "+e," delimiter: "+i," section: "+r)),n},processAffliate:function(e,r){var n=!0,o=document.location.href.indexOf(e)>-1,a={};if(o){for(var s in r){var f=r[s],c=t.getQueryStringVariable(f);""===c&&(n=!1,console.log("tracking: missing affliate parameter: "+s)),a[s]=c}n&&i.saveSalesAttributionJson(a,!0)}},saveSalesAttributionJson:function(e,r){e=JSON.stringify(e),i.saveAttribution("salesAttribution",e,null,r),t.setCookie("saLastSetDate",Date.now())},saveAttribution:function(e,r,n,o){!0===o&&i.clearAttribution(),n||(n=30),r&&"{}"!==r&&t.setCookie(e,r,n,!0)}},t={getQueryStringVariable:function(e){for(var i=window.location.search.substring(1),t=i.split("&"),r=0;r<t.length;r++){var n=t[r].split("=");if(n[0]==e)return n[1]}return!1},setCookie:function(e,t,r){var n="";if(r){var o=new Date;o.setTime(o.getTime()+24*r*60*60*1e3),n="; expires="+o.toGMTString()}document.cookie=e+"="+t+n+"; path=/; domain="+i.config.cookieDomain+";"},getCookie:function(e){for(var i=e+"=",t=document.cookie.split(";"),r=0;r<t.length;r++){for(var n=t[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return null},eatCookie:function(e){t.setCookie(e,"",-1)}};e(document).ready(function(){i.init()})}(jQuery);